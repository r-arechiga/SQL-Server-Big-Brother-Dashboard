I'd like to give a snipet of how I go about gathering the data needed to populate my dashboard and automated ticketing.

1. To give some insight to how I did things as a Jr. DBA
2. This may help other DBAs or system admins with their own monitoring/alerting in some way.


## Tempdb
This is how I track metrics for my Tempdb insight page. 

CREATE TABLE Command. I run this in my central dashboard database. This will be where we store all the tempdb related data for all our servers.

CREATE TABLE [dbo].[Dashboard_TempDB]( 
[ServerName] [nvarchar](128) NULL, 
[CurrentDateTime] [datetime] NULL, 
[FileName] [nvarchar](128) NULL, 
[FileType] [nvarchar](60) NULL, 
[TotalSize_MB] [decimal](18, 2) NULL, 
[UsedSpace_MB] [decimal](18, 2) NULL, 
[FreeSpace_MB] [decimal](18, 2) NULL, 
[FreeSpacePercentage] [decimal](10, 2) NULL 
) ON [PRIMARY] 
GO			
---



Once this table exists in your central database, you are ready to proceed with running this Powershell script. It's a very simple refresh of new data, we truncate or "empty the bucket"
and we then "fill the bucket" with new data gathered from the powershell run. In this example I used a CSV file to serve as the serverlist to iterate through. In the CPU example, I use a hardcoded list. 
Now as i've matured, I utilize a custom stored procedure to reference active servers in our envionrment via a master table. 
This script is ran under an account with sysadmin rights in SQL Server.

POWERSHELL.EXE FILE

---

$Server = "OurServerName"
$Database = "CentralDBName"
$Table = "Dashboard_TempDB"

# Build the connection string
$ConnectionString = "Server=$Server;Database=$Database;Integrated Security=True"

Invoke-Sqlcmd -Query "
USE[DBStatus]
TRUNCATE TABLE Dashboard_TempDB 

" -ServerInstance $Server

write-host "Table turncated" -ForegroundColor Green


#----------------Grab data ---------------------------
#List of servers to make changes in
$ServerList = Import-Csv "C:\Powershell\tempdb.csv"
# Loop through each row containing dbserver names in the CSV file
foreach ($server in $ServerList) {

    #Read server data from each field in each row and assign the data to a variable as below
    $servername = $server.ServerName
  


$Results = Invoke-Sqlcmd -Query "
USE tempdb;
GO

SELECT 
    @@SERVERNAME as 'ServerName',
    GETDATE() AS 'CurrentDateTime',
    name AS FileName,
    type_desc AS FileType,
    size * 8 / 1024 AS TotalSize_MB,
    FILEPROPERTY(name, 'SpaceUsed') * 8 / 1024 AS UsedSpace_MB,
    (size - FILEPROPERTY(name, 'SpaceUsed')) * 8 / 1024 AS FreeSpace_MB,
    ((size - FILEPROPERTY(name, 'SpaceUsed')) * 1.0 / size) * 100 AS FreeSpacePercentage
FROM sys.database_files;

" -ServerInstance $ServerName 

Write-host "$Servername has been grabbed" -ForegroundColor Cyan


#------------------------------------------------------------------------------

$Server = "OurServerName"
$Database = "CentralDBName"
$Table = "Dashboard_TempDB"

# Build the connection string
$ConnectionString = "Server=$Server;Database=$Database;Integrated Security=True"


# Iterate through each row of the CSV data and insert it into the SQL table
$results | ForEach-Object {
        $Query = "INSERT INTO $Table (ServerName, CurrentDateTime, FileName, FileType, TotalSize_MB, UsedSpace_MB, FreeSpace_MB, FreeSpacePercentage  ) VALUES ('$($_.ServerName)', '$($_.CurrentDateTime)', '$($_.FileName)', '$($_.FileType)', '$($_.TotalSize_MB)', '$($_.UsedSpace_MB)', '$($_.FreeSpace_MB)', '$($_.FreeSpacePercentage)' )"
        Invoke-Sqlcmd -Query $Query -ConnectionString $ConnectionString
}

Write-host "Table updated" -ForegroundColor Yellow

}

---

POWERBI DESKTOP

---

Now we have data filled in our table, we can now utlize PowerBI to connect to this newly refreshed table and create the gauge and conditional formatting for the viewers to rely on. 
- Once the data is loaded, choose the gauge visual.
- In the VALUE section, choose "Min of FreeSpacePercentage" this will make it so that the lowest value of TEMPDB in your whole dataset is the front page of the whole thing.
- Conditoinal Formatting goes as follows:
    Gradient color system
        Min Value 0 = Red
        Middle Value 50 = Yellow
        Max Value 100 = Green



